{{ define "media-albums-show.html" }}
<!DOCTYPE html>
<html lang="{{ .Lang }}">
<head>
    <meta charset="UTF-8">
    <title>{{ .Data.Album.Title }}</title>
    {{ template "styles-private" . }}
    <link rel="stylesheet" href="/static/css/media.css">
</head>
<body>
    {{ if .UserLoggedIn }}
        {{ template "header-private" . }}
        {{ template "menu" . }}
    {{ else }}
        {{ template "header-public" . }}
    {{ end }}
    <main class="contingut-principal media-layout" {{ if and .Data.CanLinkPages .Data.LinkedBook }}data-media-page-link data-page-endpoint="/api/media/llibres/pagines/suggest" data-llibre-id="{{ .Data.LinkedBook.ID }}"{{ end }}>
        <section class="card" id="media-items">
            <header class="card-header amb-accio">
                <div>
                    <h1>{{ .Data.Album.Title }}</h1>
                    <div class="media-chip-row">
                        <span class="media-chip">{{ t $.Lang (printf "media.album.type.%s" .Data.Album.AlbumType) }}</span>
                        <span class="media-chip media-chip-muted">{{ t $.Lang (printf "media.album.status.%s" .Data.Album.ModerationStatus) }}</span>
                    </div>
                </div>
                <div class="card-actions">
                    {{ if .UserLoggedIn }}
                        <a class="boto-secundari" href="/media/albums"><i class="fas fa-arrow-left"></i> {{ t .Lang "common.back" }}</a>
                    {{ else }}
                        <a class="boto-secundari" href="/"><i class="fas fa-arrow-left"></i> {{ t .Lang "common.back" }}</a>
                    {{ end }}
                </div>
            </header>
            {{ if .Data.Album.Description }}
            <p class="media-album-description">{{ .Data.Album.Description }}</p>
            {{ end }}
        {{ if or (gt .Data.Uploaded 0) (gt .Data.Failed 0) }}
        {{ $alertClass := "media-alert" }}
        {{ if eq .Data.Failed 0 }}{{ $alertClass = "media-alert success" }}{{ end }}
        <div class="{{ $alertClass }}">{{ t .Lang "media.upload.result" .Data.Uploaded .Data.Failed }}</div>
        {{ end }}
        </section>

        {{ if .Data.LinkedBook }}
        <section class="card">
            <header class="card-header amb-accio">
                <div>
                    <h2>{{ t .Lang "media.album.book.linked.title" }}</h2>
                    {{ if .Data.LinkedBook.Cronologia }}
                    <p class="media-help">{{ .Data.LinkedBook.Cronologia }}</p>
                    {{ end }}
                </div>
                <div class="card-actions">
                    {{ if .Data.CanViewBook }}
                    <a class="boto-secundari" href="/documentals/llibres/{{ .Data.LinkedBook.ID }}" target="_blank" rel="noopener">
                        <i class="fas fa-book-open"></i> {{ t .Lang "media.album.book.linked.view" }}
                    </a>
                    {{ end }}
                </div>
            </header>
            <div class="media-book-linked">
                <div class="media-book-linked-title">{{ .Data.LinkedBookLabel }}</div>
                {{ if .Data.LinkedBook.NomEsglesia }}
                <div class="media-book-linked-meta">{{ .Data.LinkedBook.NomEsglesia }}</div>
                {{ end }}
            </div>
        </section>
        {{ end }}

        {{ if .Data.CanUpload }}
        <section class="card">
            <header class="card-header">
                <h2>{{ t .Lang "media.album.upload.title" }}</h2>
                <p class="media-help">{{ t .Lang "media.album.upload.help" .Data.AllowedMimeCSV .Data.MaxUploadMB }}</p>
            </header>
            <form class="media-upload-form" method="post" action="/media/albums/{{ .Data.Album.PublicID }}/upload" enctype="multipart/form-data">
                <input type="hidden" name="csrf_token" value="{{ .Data.CSRFToken }}">
                <input class="media-file-input" type="file" name="media_files" accept="{{ .Data.AllowedMimeCSV }}" multiple>
                <button class="boto-primari" type="submit"><i class="fas fa-upload"></i> {{ t .Lang "media.album.upload.submit" }}</button>
            </form>
        </section>
        {{ end }}

        <section class="card">
            <header class="card-header">
                <h2>{{ t .Lang "media.items.title" }}</h2>
            </header>
            {{ if .Data.Items }}
            <div class="media-items-grid">
                {{ range .Data.Items }}
                <article class="media-item-card">
                    <a class="media-item-link" href="/media/items/{{ .PublicID }}">
                        {{ if .ThumbPath }}
                        <img class="media-thumb" src="/media/items/{{ .PublicID }}/thumb" alt="{{ .Title }}">
                        {{ else }}
                        <div class="media-thumb media-thumb-placeholder">
                            <i class="fas fa-image"></i>
                        </div>
                        {{ end }}
                    </a>
                    <div class="media-item-meta">
                        <h3><a href="/media/items/{{ .PublicID }}">{{ .Title }}</a></h3>
                        <div class="media-chip-row">
                            <span class="media-chip media-chip-muted">{{ .MimeType }}</span>
                            <span class="media-chip">{{ t $.Lang (printf "media.item.status.%s" .DerivativesStatus) }}</span>
                            {{ $linkCount := index $.Data.ItemLinkCounts .ID }}
                            {{ if $linkCount }}
                            <span class="media-chip">{{ t $.Lang "media.item.linked" $linkCount }}</span>
                            {{ end }}
                        </div>
                    </div>
                    {{ $links := index $.Data.ItemLinks .ID }}
                    {{ $hasLinks := false }}
                    {{ if $links }}
                        {{ if gt (len $links) 0 }}{{ $hasLinks = true }}{{ end }}
                    <div class="media-item-links">
                        {{ range $links }}
                        <div class="media-item-link-row">
                            <span class="media-link-label">
                                {{ t $.Lang "media.album.page.label" }}
                                {{ if .NumPagina.Valid }}{{ .NumPagina.Int64 }}{{ else }}{{ .PaginaID.Int64 }}{{ end }}
                            </span>
                            {{ if and $.Data.CanViewBook $.Data.BookURLBase $.Data.BookURLPrefix .NumPagina.Valid }}
                            <a class="media-link-official" href="{{ printf "%s%s%d" $.Data.BookURLBase $.Data.BookURLPrefix .NumPagina.Int64 }}" target="_blank" rel="noopener">
                                {{ t $.Lang "media.album.page.official" }}
                            </a>
                            {{ end }}
                            {{ if $.Data.CanLinkPages }}
                            <form class="media-item-link-actions" method="post" action="/media/albums/{{ $.Data.Album.PublicID }}/pages/unlink">
                                <input type="hidden" name="csrf_token" value="{{ $.Data.CSRFToken }}">
                                <input type="hidden" name="media_item_public_id" value="{{ .MediaItemPublicID }}">
                                <input type="hidden" name="pagina_id" value="{{ if .PaginaID.Valid }}{{ .PaginaID.Int64 }}{{ end }}">
                                <input type="hidden" name="return_to" value="/media/albums/{{ $.Data.Album.PublicID }}#media-items">
                                <button type="submit" class="boto-secundari btn-mini">{{ t $.Lang "media.album.page.unlink" }}</button>
                            </form>
                            {{ end }}
                        </div>
                        {{ end }}
                    </div>
                    {{ end }}
                    {{ if $.Data.CanLinkPages }}
                        {{ if $hasLinks }}
                        <details class="media-link-editor">
                            <summary class="media-link-editor-summary">
                                <span>
                                    {{ t $.Lang "media.album.page.linked" }}:
                                    {{ range $i, $link := $links }}{{ if $i }}, {{ end }}{{ if $link.NumPagina.Valid }}{{ $link.NumPagina.Int64 }}{{ else }}{{ $link.PaginaID.Int64 }}{{ end }}{{ end }}
                                </span>
                                <span class="media-link-editor-action">{{ t $.Lang "media.album.page.change" }}</span>
                            </summary>
                            <form class="media-item-link-form" method="post" action="/media/albums/{{ $.Data.Album.PublicID }}/pages/link" data-page-link-form>
                                <input type="hidden" name="csrf_token" value="{{ $.Data.CSRFToken }}">
                                <input type="hidden" name="media_item_public_id" value="{{ .PublicID }}">
                                <input type="hidden" name="pagina_id" data-page-id>
                                <input type="hidden" name="pagina_num" data-page-num>
                                <input type="hidden" name="return_to" value="/media/albums/{{ $.Data.Album.PublicID }}#media-items">
                                <div class="media-page-input suggest-field">
                                    <label class="sr-only" for="page-input-{{ .ID }}">{{ t $.Lang "media.album.page.input.label" }}</label>
                                    <input id="page-input-{{ .ID }}" type="text" placeholder="{{ t $.Lang "media.album.page.input.placeholder" }}" data-page-input>
                                    <ul class="resultats-cerca" data-page-suggestions data-empty-label="{{ t $.Lang "common.empty" }}"></ul>
                                </div>
                                <button type="submit" class="boto-secundari btn-mini">{{ t $.Lang "media.album.page.change" }}</button>
                            </form>
                        </details>
                        {{ else }}
                        <form class="media-item-link-form" method="post" action="/media/albums/{{ $.Data.Album.PublicID }}/pages/link" data-page-link-form>
                            <input type="hidden" name="csrf_token" value="{{ $.Data.CSRFToken }}">
                            <input type="hidden" name="media_item_public_id" value="{{ .PublicID }}">
                            <input type="hidden" name="pagina_id" data-page-id>
                            <input type="hidden" name="pagina_num" data-page-num>
                            <input type="hidden" name="return_to" value="/media/albums/{{ $.Data.Album.PublicID }}#media-items">
                            <div class="media-page-input suggest-field">
                                <label class="sr-only" for="page-input-{{ .ID }}">{{ t $.Lang "media.album.page.input.label" }}</label>
                                <input id="page-input-{{ .ID }}" type="text" placeholder="{{ t $.Lang "media.album.page.input.placeholder" }}" data-page-input>
                                <ul class="resultats-cerca" data-page-suggestions data-empty-label="{{ t $.Lang "common.empty" }}"></ul>
                            </div>
                            <button type="submit" class="boto-secundari btn-mini">{{ t $.Lang "media.album.page.link" }}</button>
                        </form>
                        {{ end }}
                    {{ end }}
                </article>
                {{ end }}
            </div>
            {{ else }}
            <p class="media-empty">{{ t .Lang "media.items.empty" }}</p>
            {{ end }}
        </section>
    </main>
    {{ template "footer" . }}
    {{ if .UserLoggedIn }}
        {{ template "scripts-private" . }}
    {{ else }}
        {{ template "scripts-public" . }}
    {{ end }}
    {{ if .UserLoggedIn }}
    <script src="/static/js/media-albums.js"></script>
    {{ end }}
</body>
</html>
{{ end }}
