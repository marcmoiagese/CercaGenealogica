{{ define "municipi-perfil-pro.html" }}
<!DOCTYPE html>
<html lang="{{ .Lang }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ t .Lang "municipis.title" }} · {{ .Data.Municipi.Nom }}</title>
    {{ template "styles-private" . }}
    <link rel="stylesheet" href="/static/css/persona.css">
    <link rel="stylesheet" href="/static/css/estils-v8.css">
    <link rel="stylesheet" href="/static/css/municipi.css">
    <link rel="stylesheet" href="/static/css/mapes.css">
    <link rel="stylesheet" href="/static/css/municipi-anecdotes.css">
    <link rel="stylesheet" href="/static/css/municipi-perfil-pro.css">
    <link rel="stylesheet" href="/static/css/municipi-demografia.css">
    <link rel="stylesheet" href="/static/css/municipi-stats-noms-cognoms.css">
</head>
<body>
    {{ if .UserLoggedIn }}
        {{ template "header-private" . }}
        {{ template "menu" . }}
    {{ else }}
        {{ template "header-public" . }}
    {{ end }}
    <main class="contingut-principal muni-page">
        {{ if .UserLoggedIn }}
        <div id="municipi-mark-state"
             data-municipi-id="{{ .Data.Municipi.ID }}"
             data-mark-type="{{ .Data.MarkType }}"
             data-mark-public="{{ if .Data.MarkPublic }}1{{ else }}0{{ end }}"
             data-mark-own="{{ if .Data.MarkOwn }}1{{ else }}0{{ end }}"
             data-csrf="{{ .Data.CSRFToken }}"
             hidden></div>
        {{ end }}
        <section class="card muni-hero">
            <div class="muni-hero-left">
                <div class="muni-title-row">
                    <h1 class="muni-title">{{ .Data.Municipi.Nom }}</h1>
                    {{ if .UserLoggedIn }}
                    <div class="opcions-dropdown">
                        <button class="boto-opcions" id="botoOpcions">
                            <i class="fas fa-cog"></i> {{ t .Lang "wiki.options.title" }} <i class="fas fa-chevron-down"></i>
                        </button>
                        <ul class="dropdown-opcions" id="dropdownOpcions">
                            <li><a href="/territori/municipis/{{ .Data.Municipi.ID }}/historial"><i class="fas fa-clock-rotate-left"></i> {{ t .Lang "wiki.options.history" }}</a></li>
                            <li><a href="/territori/municipis/{{ .Data.Municipi.ID }}/estadistiques"><i class="fas fa-chart-line"></i> {{ t .Lang "wiki.options.stats" }}</a></li>
                            <li><a href="#" class="btn-marcar" data-municipi-id="{{ .Data.Municipi.ID }}" onclick="event.preventDefault()"><i class="fas fa-eye"></i> {{ t .Lang "wiki.options.follow" }}</a></li>
                        </ul>
                    </div>
                    {{ end }}
                    <div class="muni-badges">
                        <span class="muni-pill"><i class="fas fa-location-dot"></i> {{ .Data.TypeLabel }}</span>
                        {{ if .Data.ShowStatusBadge }}
                        <span class="muni-badge {{ if eq .Data.Municipi.ModeracioEstat "publicat" }}badge-success{{ else if eq .Data.Municipi.ModeracioEstat "pendent" }}badge-warning{{ else }}badge-muted{{ end }}">
                            {{ t .Lang (printf "activity.status.%s" .Data.Municipi.ModeracioEstat) }}
                        </span>
                        {{ end }}
                        {{ if .Data.RegionLabel }}
                        <span class="muni-badge badge-muted">{{ .Data.RegionLabel }}</span>
                        {{ end }}
                    </div>
                </div>
                <p class="muted muni-subtitle">{{ t .Lang "municipi.pro.hero.subtitle" }}</p>
                {{ if or .Data.CanViewLlibres .Data.CanCreateLlibre }}
                <div class="muni-actions">
                    {{ if .Data.CanViewLlibres }}
                    <a class="boto-primari" href="{{ .Data.LlibresURL }}"><i class="fas fa-folder-open"></i> {{ t .Lang "municipi.pro.cta.catalog" }}</a>
                    {{ end }}
                    {{ if .Data.CanCreateLlibre }}
                    <a class="boto-secundari" href="/documentals/llibres/new"><i class="fas fa-plus"></i> {{ t .Lang "municipi.pro.cta.suggest" }}</a>
                    {{ end }}
                </div>
                {{ end }}
            </div>
            <div class="muni-hero-right">
                <dl class="muni-kv">
                    <div>
                        <dt>{{ t .Lang "municipis.form.postal" }}</dt>
                        <dd>{{ if .Data.Municipi.CodiPostal }}{{ .Data.Municipi.CodiPostal }}{{ else }}-{{ end }}</dd>
                    </div>
                    <div>
                        <dt>{{ t .Lang "municipis.form.lat" }}</dt>
                        <dd>{{ if .Data.Municipi.Latitud.Valid }}{{ .Data.Municipi.Latitud.Float64 }}{{ else }}-{{ end }}</dd>
                    </div>
                    <div>
                        <dt>{{ t .Lang "municipis.form.lon" }}</dt>
                        <dd>{{ if .Data.Municipi.Longitud.Valid }}{{ .Data.Municipi.Longitud.Float64 }}{{ else }}-{{ end }}</dd>
                    </div>
                    <div>
                        <dt>{{ t .Lang "municipis.form.wikipedia" }}</dt>
                        <dd>{{ if .Data.Municipi.Wikipedia }}<a class="enllaç" href="{{ .Data.Municipi.Wikipedia }}" target="_blank" rel="noreferrer">{{ t .Lang "common.view" }}</a>{{ else }}-{{ end }}</dd>
                    </div>
                    <div>
                        <dt>{{ t .Lang "municipis.form.web" }}</dt>
                        <dd>{{ if .Data.Municipi.Web }}<a class="enllaç" href="{{ .Data.Municipi.Web }}" target="_blank" rel="noreferrer">{{ t .Lang "common.view" }}</a>{{ else }}-{{ end }}</dd>
                    </div>
                </dl>
            </div>
        </section>

        <div class="muni-grid">
            <aside class="muni-left">
                <section class="card muni-card">
                    <header class="card-header">
                        <h2>{{ t .Lang "maps.title" }}</h2>
                    </header>
                    <div class="muni-map" id="muniMiniMap">
                        <div class="muni-map-empty">
                            <i class="fas fa-map"></i>
                            <div>{{ t .Lang "maps.empty" }}</div>
                        </div>
                    </div>
                </section>

                <section class="card muni-card">
                    <header class="card-header">
                        <h2>{{ t .Lang "municipi.public.section.hierarchy" }}</h2>
                    </header>
                    <ol class="muni-hierarchy" id="muniHierarchy">
                        {{ if .Data.CountryLabel }}
                        <li class="muni-h-item">
                            <span class="muni-h-label">{{ t .Lang "municipis.col.country" }}</span>
                            <span class="muni-h-value">{{ .Data.CountryLabel }}</span>
                        </li>
                        {{ end }}
                        {{ if .Data.Hierarchy }}
                            {{ range .Data.Hierarchy }}
                            <li class="muni-h-item">
                                <span class="muni-h-label">{{ .Tipus }}</span>
                                <span class="muni-h-value">{{ .Nom }}</span>
                                <span class="muted">{{ t $.Lang "levels.col.level" }} {{ .Nivel }}</span>
                            </li>
                            {{ end }}
                        {{ else }}
                            <li class="muni-h-item">{{ t .Lang "common.empty" }}</li>
                        {{ end }}
                    </ol>
                </section>

                <section class="card muni-card muni-callout">
                    <div class="muni-callout-icon"><i class="fas fa-layer-group"></i></div>
                    <div>
                        <h3 class="muni-callout-title">{{ t .Lang "municipi.pro.maps.callout.title" }}</h3>
                        <p class="muted muni-callout-text">{{ t .Lang "municipi.pro.maps.callout.text" }}</p>
                        <div class="muni-callout-actions">
                            <a class="boto-secundari btn-mini" href="/territori/municipis/{{ .Data.Municipi.ID }}/mapes">{{ t .Lang "municipi.pro.maps.cta.all" }}</a>
                            {{ if .UserLoggedIn }}
                            <a class="boto-primari btn-mini" href="/territori/municipis/{{ .Data.Municipi.ID }}/mapes">
                                {{ if .Data.CanCreateMap }}{{ t .Lang "municipi.pro.maps.cta.create" }}{{ else }}{{ t .Lang "municipi.pro.maps.cta.propose" }}{{ end }}
                            </a>
                            {{ end }}
                        </div>
                    </div>
                </section>
            </aside>

            <section class="muni-right">
                <section class="card muni-card">
                    <header class="card-header muni-card-header-row">
                        <div>
                            <h2>{{ t .Lang "books.title" }}</h2>
                            <p class="muted">{{ t .Lang "books.filter.type" }}</p>
                        </div>
                        {{ if .Data.CanViewLlibres }}
                        <a class="boto-secundari" href="{{ .Data.LlibresURL }}"><i class="fas fa-list"></i> {{ t .Lang "common.view" }}</a>
                        {{ end }}
                    </header>
                    <div class="muni-cat-grid">
                        {{ if .Data.LlibreCategories }}
                            {{ range .Data.LlibreCategories }}
                            <a class="muni-cat-card" href="{{ .Href }}">
                                <div class="muni-cat-icon"><i class="fas {{ .Icon }}"></i></div>
                                <div>
                                    <div class="muni-cat-title">{{ .Label }}</div>
                                    <div class="muni-cat-count">{{ .Count }} {{ .CountLabel }}</div>
                                </div>
                            </a>
                            {{ end }}
                        {{ else }}
                            <div class="muted">{{ t .Lang "common.empty" }}</div>
                        {{ end }}
                    </div>
                </section>
                <section class="card muni-card muni-demografia" data-demografia-summary data-series-url="/api/municipis/{{ .Data.Municipi.ID }}/demografia/series">
                    <header class="card-header muni-card-header-row">
                        <div>
                            <h2>{{ t .Lang "municipi.demografia.title" }}</h2>
                            <p class="muted">{{ t .Lang "municipi.demografia.subtitle" }}</p>
                        </div>
                        <a class="boto-secundari btn-mini" href="/territori/municipis/{{ .Data.Municipi.ID }}/demografia">{{ t .Lang "municipi.demografia.view_all" }}</a>
                    </header>
                    <div class="demografia-summary">
                        {{ if .Data.DemografiaSummary.HasData }}
                            <div class="demografia-range">
                                <span class="demografia-range-label">{{ t .Lang "municipi.demografia.range" }}</span>
                                <span class="demografia-range-value">
                                    {{ if and (gt .Data.DemografiaSummary.AnyMin 0) (gt .Data.DemografiaSummary.AnyMax 0) }}
                                        {{ if eq .Data.DemografiaSummary.AnyMin .Data.DemografiaSummary.AnyMax }}
                                            {{ .Data.DemografiaSummary.AnyMin }}
                                        {{ else }}
                                            {{ .Data.DemografiaSummary.AnyMin }} - {{ .Data.DemografiaSummary.AnyMax }}
                                        {{ end }}
                                    {{ else }}
                                        -
                                    {{ end }}
                                </span>
                            </div>
                            <div class="demografia-kpis">
                                <div class="demografia-kpi">
                                    <span class="demografia-kpi-label">{{ t .Lang "municipi.demografia.natalitat" }}</span>
                                    <strong class="demografia-kpi-value">{{ .Data.DemografiaSummary.TotalNatalitat }}</strong>
                                </div>
                                <div class="demografia-kpi">
                                    <span class="demografia-kpi-label">{{ t .Lang "municipi.demografia.matrimonis" }}</span>
                                    <strong class="demografia-kpi-value">{{ .Data.DemografiaSummary.TotalMatrimonis }}</strong>
                                </div>
                                <div class="demografia-kpi">
                                    <span class="demografia-kpi-label">{{ t .Lang "municipi.demografia.defuncions" }}</span>
                                    <strong class="demografia-kpi-value">{{ .Data.DemografiaSummary.TotalDefuncions }}</strong>
                                </div>
                            </div>
                            <div class="demografia-footer">
                                <div class="demografia-total">
                                    <span class="demografia-total-label">{{ t .Lang "municipi.demografia.total" }}</span>
                                    <strong class="demografia-total-value">{{ .Data.DemografiaSummary.Total }}</strong>
                                </div>
                                <div class="demografia-spark" data-demografia-spark aria-hidden="true"></div>
                            </div>
                        {{ else }}
                            <p class="muted demografia-empty">{{ t .Lang "municipi.demografia.empty" }}</p>
                            <div class="demografia-empty-actions">
                                {{ if .Data.CanViewLlibres }}
                                <a class="boto-secundari btn-mini" href="{{ .Data.LlibresURL }}">{{ t .Lang "municipi.pro.cta.catalog" }}</a>
                                {{ end }}
                                {{ if .Data.CanCreateLlibre }}
                                <a class="boto-primari btn-mini" href="/documentals/llibres/new">{{ t .Lang "municipi.pro.cta.suggest" }}</a>
                                {{ end }}
                            </div>
                        {{ end }}
                    </div>
                </section>
                <div class="muni-stats-grid">
                    <section class="card muni-card muni-stats-card"
                             data-stats-card
                             data-base-url="/api/municipis/{{ .Data.Municipi.ID }}/stats/top-noms"
                             data-series-url="/api/municipis/{{ .Data.Municipi.ID }}/stats/nom-series"
                             data-series-param="nom_id"
                             data-empty-totals="{{ t .Lang "municipi.stats.empty.totals" }}"
                             data-empty-series="{{ t .Lang "municipi.stats.empty.series" }}"
                             data-bucket="decade">
                        <header class="card-header muni-card-header-row">
                            <div>
                                <h2>{{ t .Lang "municipi.stats.noms.title" }}</h2>
                                <p class="muted">{{ t .Lang "municipi.stats.noms.subtitle" }}</p>
                            </div>
                            <div class="muni-stats-tabs" role="tablist" aria-label="{{ t .Lang "municipi.stats.noms.title" }}">
                                <button class="muni-stats-tab is-active" type="button" data-tab="totals">{{ t .Lang "municipi.stats.tab.totals" }}</button>
                                <button class="muni-stats-tab" type="button" data-tab="series">{{ t .Lang "municipi.stats.tab.series" }}</button>
                            </div>
                        </header>
                        <div class="muni-stats-panel is-active" data-panel="totals">
                            <div class="muni-stats-meta">
                                <span class="muni-stats-meta-label">{{ t .Lang "municipi.stats.total.distinct" }}</span>
                                <strong class="muni-stats-meta-value" data-total-distinct>-</strong>
                            </div>
                            <ol class="muni-stats-list" id="muniTopNamesTotals" data-top-list></ol>
                        </div>
                        <div class="muni-stats-panel" data-panel="series">
                            <label class="muni-stats-select-label" for="muniTopNamesSelect">{{ t .Lang "municipi.stats.select.nom" }}</label>
                            <select class="muni-stats-select" id="muniTopNamesSelect"></select>
                            <div class="muni-stats-series" id="muniTopNamesSeries" data-series-chart></div>
                        </div>
                    </section>
                    <section class="card muni-card muni-stats-card"
                             data-stats-card
                             data-base-url="/api/municipis/{{ .Data.Municipi.ID }}/stats/top-cognoms"
                             data-series-url="/api/municipis/{{ .Data.Municipi.ID }}/stats/cognom-series"
                             data-series-param="cognom_id"
                             data-empty-totals="{{ t .Lang "municipi.stats.empty.totals" }}"
                             data-empty-series="{{ t .Lang "municipi.stats.empty.series" }}"
                             data-bucket="decade">
                        <header class="card-header muni-card-header-row">
                            <div>
                                <h2>{{ t .Lang "municipi.stats.cognoms.title" }}</h2>
                                <p class="muted">{{ t .Lang "municipi.stats.cognoms.subtitle" }}</p>
                            </div>
                            <div class="muni-stats-tabs" role="tablist" aria-label="{{ t .Lang "municipi.stats.cognoms.title" }}">
                                <button class="muni-stats-tab is-active" type="button" data-tab="totals">{{ t .Lang "municipi.stats.tab.totals" }}</button>
                                <button class="muni-stats-tab" type="button" data-tab="series">{{ t .Lang "municipi.stats.tab.series" }}</button>
                            </div>
                        </header>
                        <div class="muni-stats-panel is-active" data-panel="totals">
                            <div class="muni-stats-meta">
                                <span class="muni-stats-meta-label">{{ t .Lang "municipi.stats.total.distinct" }}</span>
                                <strong class="muni-stats-meta-value" data-total-distinct>-</strong>
                            </div>
                            <ol class="muni-stats-list" id="muniTopSurnamesTotals" data-top-list></ol>
                        </div>
                        <div class="muni-stats-panel" data-panel="series">
                            <label class="muni-stats-select-label" for="muniTopSurnamesSelect">{{ t .Lang "municipi.stats.select.cognom" }}</label>
                            <select class="muni-stats-select" id="muniTopSurnamesSelect"></select>
                            <div class="muni-stats-series" id="muniTopSurnamesSeries" data-series-chart></div>
                        </div>
                    </section>
                </div>
                <section class="card muni-card muni-maps">
                    <header class="card-header muni-maps-header">
                        <div>
                            <h2>{{ t .Lang "municipi.pro.maps.section.title" }}</h2>
                            <p class="muni-section-subtitle">{{ t .Lang "municipi.pro.maps.section.subtitle" }}</p>
                        </div>
                        <div class="muni-maps-header-actions" aria-label="{{ t .Lang "municipi.pro.maps.section.title" }}">
                            <button class="boto-secundari btn-mini" type="button" id="muniMapPrev" aria-label="{{ t .Lang "municipi.pro.maps.controls.prev" }}">
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <button class="boto-secundari btn-mini" type="button" id="muniMapNext" aria-label="{{ t .Lang "municipi.pro.maps.controls.next" }}">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                            <button class="boto-secundari btn-mini" type="button" id="muniMapsGear" aria-label="{{ t .Lang "municipi.pro.maps.controls.options" }}">
                                <i class="fas fa-gear"></i>
                            </button>
                        </div>
                    </header>

                    <div class="muni-maps-viewport" id="muniMapsViewport" aria-label="{{ t .Lang "maps.viewer.aria" }}" data-empty="{{ t .Lang "maps.empty" }}" data-loading="{{ t .Lang "common.loading" }}" data-chip-default="{{ t .Lang "municipi.pro.maps.viewer.chip" }}">
                        <div class="muni-maps-slides" id="muniMapsSlides"></div>
                        <div class="muni-map-tooltip" id="muniMapTooltip" aria-hidden="true"></div>
                        <div class="muni-maps-chip" id="muniMapsChip">
                            <i class="fas fa-layer-group"></i> <span id="muniMapsChipText">{{ t .Lang "municipi.pro.maps.viewer.chip" }}</span>
                        </div>
                        <div class="muni-maps-popover" id="muniMapsPopover" hidden>
                            <div class="popover-head">
                                <div class="popover-title"><i class="fas fa-sliders"></i> {{ t .Lang "municipi.pro.maps.layers.title" }}</div>
                                <button class="popover-close" type="button" id="muniMapsPopoverClose" aria-label="{{ t .Lang "common.close" }}">
                                    <i class="fas fa-xmark"></i>
                                </button>
                            </div>
                            <div class="popover-grid">
                                <label class="muni-toggle"><span>{{ t .Lang "municipi.pro.maps.layers.houses" }}</span><input type="checkbox" id="optLayerHouses" checked></label>
                                <label class="muni-toggle"><span>{{ t .Lang "municipi.pro.maps.layers.streets" }}</span><input type="checkbox" id="optLayerStreets" checked></label>
                                <label class="muni-toggle"><span>{{ t .Lang "municipi.pro.maps.layers.rivers" }}</span><input type="checkbox" id="optLayerRivers" checked></label>
                                <label class="muni-toggle"><span>{{ t .Lang "municipi.pro.maps.layers.elements" }}</span><input type="checkbox" id="optLayerElements" checked></label>
                                <label class="muni-toggle"><span>{{ t .Lang "municipi.pro.maps.layers.toponyms" }}</span><input type="checkbox" id="optLayerToponyms" checked></label>
                                <label class="muni-toggle"><span>{{ t .Lang "municipi.pro.maps.layers.bounds" }}</span><input type="checkbox" id="optLayerBounds"></label>
                            </div>
                        </div>
                    </div>
                </section>

                <section class="card muni-card muni-history">
                    <header class="card-header">
                        <h2>{{ t .Lang "municipi.history.title" }}</h2>
                    </header>
                    <div class="muni-history-content">
                        <p class="muted muni-history-subtitle">{{ t .Lang "municipi.history.subtitle" }}</p>
                        <div class="muni-history-summary">
                            {{ if .Data.HistoriaGeneral }}
                                {{ if .Data.HistoriaGeneral.Titol }}
                                    <h3 class="muni-history-title">{{ .Data.HistoriaGeneral.Titol }}</h3>
                                {{ else }}
                                    <h3 class="muni-history-title">{{ t .Lang "municipi.history.general" }}</h3>
                                {{ end }}
                                {{ if .Data.HistoriaGeneralSummary }}
                                    <p class="muni-history-text">{{ .Data.HistoriaGeneralSummary }}</p>
                                {{ else }}
                                    <p class="muted">{{ t .Lang "municipi.history.empty_general" }}</p>
                                {{ end }}
                            {{ else }}
                                <h3 class="muni-history-title">{{ t .Lang "municipi.history.general" }}</h3>
                                <p class="muted">{{ t .Lang "municipi.history.empty_general" }}</p>
                            {{ end }}
                        </div>
                        <div class="muni-history-timeline" id="muniTimeline">
                            <h4 class="muni-history-section">{{ t .Lang "municipi.history.timeline" }}</h4>
                            {{ if .Data.HistoriaTimelineDestacat }}
                                <ul class="muni-history-list">
                                    {{ range .Data.HistoriaTimelineDestacat }}
                                        <li class="muni-history-item">
                                            <span class="muni-history-date">{{ .date }}</span>
                                            <span class="muni-history-item-text">{{ .title }}</span>
                                        </li>
                                    {{ end }}
                                </ul>
                            {{ else }}
                                <p class="muted">{{ t .Lang "municipi.history.empty_timeline" }}</p>
                            {{ end }}
                        </div>
                        <div class="muni-history-actions">
                            <a class="boto-secundari btn-mini" id="ctaHistoryAll" href="/territori/municipis/{{ .Data.Municipi.ID }}/historia">{{ t .Lang "municipi.history.view_all" }}</a>
                            {{ if .Data.CanAportarHistoria }}
                                <a class="boto-primari btn-mini" id="ctaAddHistory" href="/territori/municipis/{{ .Data.Municipi.ID }}/historia/aportar">{{ t .Lang "municipi.history.contribute" }}</a>
                            {{ end }}
                        </div>
                    </div>
                </section>

                <section class="card muni-card muni-events">
                    <header class="card-header muni-card-header-row">
                        <div>
                            <h2>{{ t .Lang "municipi.events.title" }}</h2>
                            <p class="muted">{{ t .Lang "municipi.events.subtitle" }}</p>
                        </div>
                        <div class="muni-events-actions">
                            <a class="boto-secundari btn-mini" href="{{ .Data.HistoricEventsURL }}">{{ t .Lang "municipi.events.view_all" }}</a>
                            <a class="boto-secundari btn-mini" href="{{ .Data.HistoricEventsTimelineURL }}">{{ t .Lang "municipi.events.view_timeline" }}</a>
                            {{ if .Data.CanCreateEvent }}
                                <a class="boto-primari btn-mini" href="{{ .Data.HistoricEventsNewURL }}">{{ t .Lang "municipi.events.cta" }}</a>
                            {{ end }}
                        </div>
                    </header>
                    <div class="muni-events-list">
                        {{ if .Data.HistoricEvents }}
                            {{ range .Data.HistoricEvents }}
                                <article class="muni-event-card">
                                    <header>
                                        <h3><a href="{{ .URL }}">{{ .Title }}</a></h3>
                                        <span class="muni-event-meta">{{ .TypeLabel }}{{ if .DateLabel }} · {{ .DateLabel }}{{ end }}</span>
                                    </header>
                                    {{ if gt .Intensity 0 }}
                                        <span class="muni-event-intensity">{{ t $.Lang "municipi.events.intensity" }} {{ .Intensity }}/5</span>
                                    {{ end }}
                                </article>
                            {{ end }}
                        {{ else }}
                            <p class="muted">{{ t .Lang "municipi.events.empty" }}</p>
                        {{ end }}
                    </div>
                </section>

                <section class="card muni-card muni-anecdotes">
                    <header class="card-header muni-card-header-row">
                        <div>
                            <h2>{{ t .Lang "municipi.anecdotes.title" }}</h2>
                            <p class="muted">{{ t .Lang "municipi.anecdotes.subtitle" }}</p>
                        </div>
                        <a class="boto-secundari btn-mini" id="ctaAnecdotesAll" href="/territori/municipis/{{ .Data.Municipi.ID }}/anecdotes">
                            {{ t .Lang "municipi.anecdotes.view_all" }}
                        </a>
                    </header>
                    <div class="muni-anecdotes-slider" id="muniAnecdoteSlider"
                         data-api="/api/municipis/{{ .Data.Municipi.ID }}/anecdotes"
                         data-detail-base="/territori/municipis/{{ .Data.Municipi.ID }}/anecdotes/"
                         data-empty="{{ t .Lang "municipi.anecdotes.empty" }}"
                         data-loading="{{ t .Lang "common.loading" }}"
                         data-read="{{ t .Lang "municipi.anecdotes.read" }}">
                        <div class="muni-anecdotes-track" id="muniAnecdoteTrack"></div>
                        <div class="muni-anecdotes-controls">
                            <button class="boto-secundari btn-mini" type="button" id="muniAnecdotePrev" aria-label="{{ t .Lang "common.prev" }}">
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <div class="muni-anecdotes-dots" id="muniAnecdoteDots"></div>
                            <button class="boto-secundari btn-mini" type="button" id="muniAnecdoteNext" aria-label="{{ t .Lang "common.next" }}">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                    <div class="muni-anecdotes-actions">
                        {{ if .Data.CanCreateAnecdote }}
                        <a class="boto-primari btn-mini" id="ctaAddAnecdote" href="/territori/municipis/{{ .Data.Municipi.ID }}/anecdotes/new">
                            {{ t .Lang "municipi.anecdotes.add" }}
                        </a>
                        {{ end }}
                    </div>
                </section>
            </section>
        </div>

        {{ if .UserLoggedIn }}
        <div class="modal-overlay" id="modalMarcarMunicipi" role="dialog" aria-modal="true">
            <div class="modal-box">
                <header class="modal-header">
                    <h3>{{ t .Lang "wiki.mark.title" }}</h3>
                    <button type="button" class="modal-close" data-modal-close="modalMarcarMunicipi">×</button>
                </header>
                <div class="grup-camp">
                    <label for="muni-mark-type">{{ t .Lang "wiki.mark.select" }}</label>
                    <select id="muni-mark-type" class="input-text">
                        <option value="">{{ t .Lang "common.select" }}</option>
                        <option value="consanguini">{{ t .Lang "wiki.mark.consanguini" }}</option>
                        <option value="politic">{{ t .Lang "wiki.mark.politic" }}</option>
                        <option value="interes">{{ t .Lang "wiki.mark.interes" }}</option>
                    </select>
                </div>
                <label class="checkbox-linia">
                    <input type="checkbox" id="muni-mark-public" checked>
                    <span>{{ t .Lang "wiki.mark.public" }}</span>
                </label>
                <div class="form-accio">
                    <button type="button" class="boto-primari" id="muni-mark-save">{{ t .Lang "wiki.mark.save" }}</button>
                    <button type="button" class="boto-secundari" id="muni-mark-clear">{{ t .Lang "wiki.mark.clear" }}</button>
                </div>
            </div>
        </div>
        {{ end }}
    </main>

    
    {{ template "footer" . }}
    {{ if .UserLoggedIn }}
        {{ template "scripts-private" . }}
    {{ else }}
        {{ template "scripts-public" . }}
    {{ end }}
    <script id="municipiProData" type="application/json">{{ toJsonJS .Data.MapesData }}</script>
    <script src="/static/js/cgmap.js"></script>
    <script src="/static/js/municipi-perfil-pro.js"></script>
    <script src="/static/js/municipi-demografia.js"></script>
    <script src="/static/js/municipi-stats-noms-cognoms.js"></script>
    <script src="/static/js/municipi-anecdotes-slider.js"></script>
    <script>
        (function () {
            const optionsBtn = document.getElementById("botoOpcions");
            const dropdown = document.getElementById("dropdownOpcions");
            if (optionsBtn && dropdown) {
                optionsBtn.addEventListener("click", function (event) {
                    event.preventDefault();
                    dropdown.style.display = dropdown.style.display === "block" ? "none" : "block";
                });
                document.addEventListener("click", function (event) {
                    if (!event.target.closest(".opcions-dropdown")) {
                        dropdown.style.display = "none";
                    }
                });
            }

            const markState = document.getElementById("municipi-mark-state");
            const modal = document.getElementById("modalMarcarMunicipi");
            const openBtn = document.querySelector(".btn-marcar");
            const closeBtns = document.querySelectorAll('[data-modal-close="modalMarcarMunicipi"]');
            if (!markState || !modal) {
                return;
            }
            const markType = modal.querySelector("#muni-mark-type");
            const markPublic = modal.querySelector("#muni-mark-public");
            const markSave = modal.querySelector("#muni-mark-save");
            const markClear = modal.querySelector("#muni-mark-clear");
            const municipiID = parseInt(markState.dataset.municipiId || "0", 10);
            const csrfToken = markState.dataset.csrf || "";

            function openModal() {
                const existingType = markState.dataset.markType || "";
                const existingPublic = markState.dataset.markPublic !== "0";
                const own = markState.dataset.markOwn === "1";
                if (markType) {
                    markType.value = existingType;
                }
                if (markPublic) {
                    markPublic.checked = existingType ? existingPublic : true;
                }
                if (markClear) {
                    markClear.disabled = !own;
                }
                modal.classList.add("is-open");
            }

            function closeModal() {
                modal.classList.remove("is-open");
            }

            if (openBtn) {
                openBtn.addEventListener("click", function () {
                    if (!municipiID) {
                        return;
                    }
                    openModal();
                });
            }
            closeBtns.forEach((btn) => {
                btn.addEventListener("click", closeModal);
            });

            if (markSave) {
                markSave.addEventListener("click", function () {
                    if (!municipiID) {
                        return;
                    }
                    const typeValue = markType ? markType.value : "";
                    if (!typeValue) {
                        return;
                    }
                    const body = new URLSearchParams();
                    body.set("csrf_token", csrfToken);
                    body.set("type", typeValue);
                    body.set("public", markPublic && markPublic.checked ? "1" : "0");
                    fetch(`/territori/municipis/${municipiID}/marcar`, {
                        method: "POST",
                        headers: { "Content-Type": "application/x-www-form-urlencoded" },
                        body: body.toString(),
                        credentials: "same-origin",
                    })
                        .then((response) => {
                            if (!response.ok) {
                                throw new Error("mark_failed");
                            }
                            return response.json();
                        })
                        .then((data) => {
                            if (data && data.ok) {
                                markState.dataset.markType = data.type || "";
                                markState.dataset.markPublic = data.is_public ? "1" : "0";
                                markState.dataset.markOwn = "1";
                                closeModal();
                            }
                        })
                        .catch(() => {});
                });
            }

            if (markClear) {
                markClear.addEventListener("click", function () {
                    if (!municipiID) {
                        return;
                    }
                    if (markState.dataset.markOwn !== "1") {
                        closeModal();
                        return;
                    }
                    const body = new URLSearchParams();
                    body.set("csrf_token", csrfToken);
                    fetch(`/territori/municipis/${municipiID}/desmarcar`, {
                        method: "POST",
                        headers: { "Content-Type": "application/x-www-form-urlencoded" },
                        body: body.toString(),
                        credentials: "same-origin",
                    })
                        .then((response) => {
                            if (!response.ok) {
                                throw new Error("mark_clear_failed");
                            }
                            return response.json();
                        })
                        .then((data) => {
                            if (data && data.ok) {
                                markState.dataset.markType = "";
                                markState.dataset.markPublic = "0";
                                markState.dataset.markOwn = "0";
                                closeModal();
                            }
                        })
                        .catch(() => {});
                });
            }
        })();
    </script>
</body>
</html>
{{ end }}
